# WICHTIG: Dieser Workflow ist deaktiviert bis das Qubic-Team die Ãœbersetzungen akzeptiert
# Um zu aktivieren: Personal Access Token (PAT) mit repo-Rechten erstellen und als UPSTREAM_PR_TOKEN speichern

name: Create Upstream PR

on:
  # pull_request:
  #   types: [closed]
  #   branches: [main]
  workflow_dispatch:  # Nur manuelles Triggern mÃ¶glich

jobs:
  create-upstream-pr:
    if: github.event.pull_request.merged == true && contains(github.event.pull_request.title, '[REVIEW NEEDED]')
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout upstream repository
        uses: actions/checkout@v4
        with:
          repository: qubic/docs
          token: ${{ secrets.UPSTREAM_PR_TOKEN }}
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config user.name "Qubic Translation Bot"
          git config user.email "translation-bot@qubic-network.de"

      - name: Add fork remote and fetch translations
        run: |
          # Deinen Fork als remote hinzufÃ¼gen
          git remote add fork https://github.com/${{ github.actor }}/qubic-docs-de.git
          git fetch fork
          
          # Zeige was im i18n Ordner ist
          echo "VerfÃ¼gbare Ãœbersetzungen im Fork:"
          git ls-tree -r fork/main --name-only | grep "^i18n/" | head -20

      - name: Create clean branch with translations
        run: |
          # Neuen Branch erstellen
          BRANCH_NAME="german-translations-$(date +%Y%m%d)"
          git checkout -b $BRANCH_NAME
          
          # Nur i18n/de/ Ordner vom Fork holen
          git checkout fork/main -- i18n/de/
          
          # Commit erstellen
          git add i18n/de/
          git commit -m "Add German translations
          
          - Translated via DeepSeek API with human review
          - Covers latest documentation updates
          - All technical terms preserved
          
          Co-authored-by: ${{ github.actor }}"
          
          # Branch pushen
          git push origin $BRANCH_NAME
          
          echo "branch_name=$BRANCH_NAME" >> $GITHUB_ENV

      - name: Create Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.UPSTREAM_PR_TOKEN }}
        run: |
          gh pr create \
            --repo qubic/docs \
            --title "German Translation Update - $(date +%Y-%m-%d)" \
            --body "$(cat << 'PRBODY'
          ## ðŸ‡©ðŸ‡ª German Translation Update
          
          This PR adds German translations for the Qubic documentation.
          
          ### What's included:
          - âœ… Latest translations synchronized with upstream
          - âœ… AI-translated via DeepSeek API
          - âœ… Reviewed by human translator
          - âœ… All technical terms preserved
          - âœ… Proper Docusaurus i18n structure (`i18n/de/`)
          
          ### Files changed:
          - German translations in `i18n/de/docusaurus-plugin-content-docs/current/`
          
          ### How to test:
          1. Pull this branch
          2. Add to `docusaurus.config.js`:
             ```javascript
             i18n: {
               defaultLocale: 'en',
               locales: ['en', 'de'],
             }
             ```
          3. Run `npm run start`
          4. Visit `http://localhost:3000/de/`
          
          ### Requirements for merge:
          - [ ] Add `de` to `locales` in `docusaurus.config.js`
          - [ ] Verify build succeeds: `npm run build`
          - [ ] Check German pages render correctly
          
          ### Maintenance:
          - Translations are automatically synced daily
          - New PRs will be created for future updates
          - This is a one-time setup - future updates just need merge
          
          ---
          *Automated translation workflow by @${{ github.actor }}*  
          *For questions about translations, please contact the German translation team*
          PRBODY
          )" \
            --head ${{ env.branch_name }} \
            --base main

      - name: Notify success
        run: |
          echo "========================================"
          echo "âœ… PR erfolgreich erstellt!"
          echo ""
          echo "Der Qubic-Maintainer bekommt jetzt:"
          echo "- Nur den i18n/de/ Ordner"
          echo "- Keine Workflow-Dateien"
          echo "- Keine Scripts"
          echo ""
          echo "Link zum PR:"
          echo "https://github.com/qubic/docs/pulls"
          echo "========================================"
